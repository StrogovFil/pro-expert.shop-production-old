BasketPoolQuantity=function(){this.processing=false;this.poolQuantity={};this.updateTimer=null;this.currentQuantity={};this.lastStableQuantities={};this.updateQuantity()};BasketPoolQuantity.prototype.updateQuantity=function(){var a=BX("basket_items");if(basketJSParams.USE_ENHANCED_ECOMMERCE==="Y"){checkAnalytics(this.lastStableQuantities,a)}if(!!a&&a.rows.length>0){for(var b=1;a.rows.length>b;b++){var c=a.rows[b].id;this.currentQuantity[c]=BX("QUANTITY_"+c).value}}this.lastStableQuantities=BX.clone(this.currentQuantity,true)};BasketPoolQuantity.prototype.changeQuantity=function(c){var b=BX("QUANTITY_"+c).value;var a=this.isPoolEmpty();if(this.currentQuantity[c]&&this.currentQuantity[c]!=b){this.poolQuantity[c]=this.currentQuantity[c]=b}if(!a){this.enableTimer(true)}else{this.trySendPool()}};BasketPoolQuantity.prototype.trySendPool=function(){if(!this.isPoolEmpty()&&!this.isProcessing()){this.enableTimer(false);recalcBasketAjax({})}};BasketPoolQuantity.prototype.isPoolEmpty=function(){return(Object.keys(this.poolQuantity).length==0)};BasketPoolQuantity.prototype.clearPool=function(){this.poolQuantity={}};BasketPoolQuantity.prototype.isProcessing=function(){return(this.processing===true)};BasketPoolQuantity.prototype.setProcessing=function(a){this.processing=(a===true)};BasketPoolQuantity.prototype.enableTimer=function(a){clearTimeout(this.updateTimer);if(a===false){return}this.updateTimer=setTimeout(function(){basketPoolQuantity.trySendPool()},1500)};function updateBasketTable(U,Q){var A=BX("basket_items"),af,Z,u,G,b,E,Y=false,N=false,ah=false,F=false,n,I,X,ae,h,B,V,y,e,C,ad,K,v,f,T,ai,H,m,x,L,s,aa,q,w,ac,W,c,D,ab,a,S,o,z,g,P,l,R,d,p,M;if(!A||typeof Q!=="object"){return}af=A.rows;G=af[af.length-1];n=(Q.PARAMS.QUANTITY_FLOAT==="Y");if(U!==null&&!!Q.BASKET_DATA){I=BX(U);Z=Q.BASKET_ID;M=BX.type.isPlainObject(Q.BASKET_DATA.GRID.ROWS[Z]);if(M){u=Q.BASKET_DATA.GRID.ROWS[Z];b=document.createElement("tr");b.setAttribute("id",Q.BASKET_ID);b.setAttribute("data-item-name",u.NAME);b.setAttribute("data-item-brand",u[basketJSParams.BRAND_PROPERTY+"_VALUE"]);b.setAttribute("data-item-price",u.PRICE);b.setAttribute("data-item-currency",u.CURRENCY);G.parentNode.insertBefore(b,I.nextSibling)}if(Q.DELETE_ORIGINAL==="Y"){I.parentNode.removeChild(I)}if(M){X=b.insertCell(-1);X.setAttribute("class","margin");E=Q.COLUMNS.split(",");for(ae=0;ae<E.length;ae++){if(E[ae]==="DELETE"){Y=true}else{if(E[ae]==="DELAY"){N=true}else{if(E[ae]==="PROPS"){ah=true}else{if(E[ae]==="TYPE"){F=true}}}}}for(ae=0;ae<E.length;ae++){switch(E[ae]){case"PROPS":case"DELAY":case"DELETE":case"TYPE":break;case"NAME":h=b.insertCell(-1);B="";V="";h.setAttribute("class","itemphoto");if(u.PREVIEW_PICTURE_SRC.length>0){B=u.PREVIEW_PICTURE_SRC}else{if(u.DETAIL_PICTURE_SRC.length>0){B=u.DETAIL_PICTURE_SRC}else{B=basketJSParams.TEMPLATE_FOLDER+"/images/no_photo.png"}}if(u.DETAIL_PAGE_URL.length>0){V='<div class="bx_ordercart_photo_container">							<a href="'+u.DETAIL_PAGE_URL+'">								<div class="bx_ordercart_photo" style="background-image:url(\''+B+"')\"></div>							</a>						</div>"}else{V='<div class="bx_ordercart_photo_container">							<div class="bx_ordercart_photo" style="background-image:url(\''+B+"')\"></div>						</div>"}if(u.BRAND&&u.BRAND.length>0){V+='<div class="bx_ordercart_brand">							<img alt="" src="'+u.BRAND+'"/>						</div>'}h.innerHTML=V;y=b.insertCell(-1);e="";y.setAttribute("class","item");if(u.DETAIL_PAGE_URL.length>0){e+='<h2 class="bx_ordercart_itemtitle"><a href="'+u.DETAIL_PAGE_URL+'">'+u.NAME+"</a></h2>"}else{e+='<h2 class="bx_ordercart_itemtitle">'+u.NAME+"</h2>"}e+='<div class="bx_ordercart_itemart">';if(ah){for(ad=0;ad<u.PROPS.length;ad++){K=u.PROPS[ad];if(u.SKU_DATA){C=false;for(v in u.SKU_DATA){if(u.SKU_DATA.hasOwnProperty(v)){f=u.SKU_DATA[v];if(f.CODE===K.CODE){C=true;break}}}if(C){continue}}e+=BX.util.htmlspecialchars(K.NAME)+":&nbsp;<span>"+K.VALUE+"</span><br/>"}}e+="</div>";if(u.SKU_DATA){l={};for(aa=0;aa<u.PROPS.length;aa++){q=u.PROPS[aa];l[q.CODE]=(BX.type.isNotEmptyString(q["~VALUE"])?q["~VALUE"]:q.VALUE)}for(v in u.SKU_DATA){if(u.SKU_DATA.hasOwnProperty(v)){R=0;f=u.SKU_DATA[v];T=false;ai=(BX.util.array_keys(f.VALUES).length>5)?"full":"";d=0;for(m in f.VALUES){d++;H=f.VALUES[m];if(BX.type.isNotEmptyString(l[f.CODE])){if(l[f.CODE]==H.NAME||l[f.CODE]==H.XML_ID){R=d}}if(!!H&&typeof H==="object"&&!!H.PICT){T=true}}p="0";if(ai!=""&&R>5){p=((5-R)*20)+"%"}if(T){e+='<div class="bx_item_detail_scu_small_noadaptive '+ai+'">';e+='<span class="bx_item_section_name_gray">'+BX.util.htmlspecialchars(f.NAME)+"</span>";e+='<div class="bx_scu_scroller_container">';e+='<div class="bx_scu">';e+='<ul id="prop_'+f.CODE+"_"+u.ID+'" style="width: 200%; margin-left: '+p+';" class="sku_prop_list">';d=0;for(s in f.VALUES){d++;x=f.VALUES[s];L=(R==d?" bx_active":"");e+='<li style="width:10%;"															class="sku_prop'+L+'" 															data-sku-selector="Y" 															data-value-id="'+x.XML_ID+'" 															data-sku-name="'+BX.util.htmlspecialchars(x.NAME)+'" 															data-element="'+u.ID+'" 															data-property="'+f.CODE+'"															>															<a href="javascript:void(0)" class="cnt"><span class="cnt_item" style="background-image:url('+x.PICT["SRC"]+'"></span></a>														</li>'}e+="</ul>";e+="</div>";e+='<div class="bx_slide_left" onclick="leftScroll(\''+f.CODE+"', "+u.ID+", "+BX.util.array_keys(f.VALUES).length+');"></div>';e+='<div class="bx_slide_right" onclick="rightScroll(\''+f.CODE+"', "+u.ID+", "+BX.util.array_keys(f.VALUES).length+');"></div>';e+="</div>";e+="</div>"}else{e+='<div class="bx_item_detail_size_small_noadaptive '+ai+'">';e+='<span class="bx_item_section_name_gray">'+BX.util.htmlspecialchars(f.NAME)+"</span>";e+='<div class="bx_size_scroller_container">';e+='<div class="bx_size">';e+='<ul id="prop_'+f.CODE+"_"+u.ID+'" style="width: 200%; margin-left: '+p+';" class="sku_prop_list">';d=0;for(s in f.VALUES){d++;x=f.VALUES[s];L=(R==d?" bx_active":"");e+='<li style="width:10%;"															class="sku_prop '+L+'" 															data-sku-selector="Y" 															data-value-id="'+(f.TYPE==="S"&&f.USER_TYPE==="directory"?x.XML_ID:BX.util.htmlspecialchars(x.NAME))+'" 															data-sku-name="'+BX.util.htmlspecialchars(x.NAME)+'" 															data-element="'+u.ID+'" 															data-property="'+f.CODE+'" 															>															<a href="javascript:void(0)" class="cnt">'+BX.util.htmlspecialchars(x.NAME)+"</a>														</li>"}e+="</ul>";e+="</div>";e+='<div class="bx_slide_left" onclick="leftScroll(\''+f.CODE+"', "+u.ID+", "+BX.util.array_keys(f.VALUES).length+');"></div>';e+='<div class="bx_slide_right" onclick="rightScroll(\''+f.CODE+"', "+u.ID+", "+BX.util.array_keys(f.VALUES).length+');"></div>';e+="</div>";e+="</div>"}}}}y.innerHTML=e;break;case"QUANTITY":w=b.insertCell(-1);ac="";W=(parseFloat(u.MEASURE_RATIO)>0)?u.MEASURE_RATIO:1;c=false;if(W!=0&&W!=""){D=u.QUANTITY;u.QUANTITY=getCorrectRatioQuantity(u.QUANTITY,W,n);if(D!=u.QUANTITY){c=true}}w.setAttribute("class","custom");ac+="<span>"+getColumnName(Q,E[ae])+":</span>";ac+='<div class="centered">';ac+='<table cellspacing="0" cellpadding="0" class="counter">';ac+="<tr>";ac+="<td>";ac+='<input type="text" size="3" id="QUANTITY_INPUT_'+u.ID+'"											name="QUANTITY_INPUT_'+u.ID+'"											style="max-width: 50px"											value="'+u.QUANTITY+'"											onchange="updateQuantity(\'QUANTITY_INPUT_'+u.ID+"','"+u.ID+"', "+W+","+n+')"						>';ac+="</td>";if(W!=0&&W!=""){ac+='<td id="basket_quantity_control">							<div class="basket_quantity_control">								<a href="javascript:void(0);" class="plus" onclick="setQuantity('+u.ID+", "+W+", 'up', "+n+');"></a>								<a href="javascript:void(0);" class="minus" onclick="setQuantity('+u.ID+", "+W+", 'down', "+n+');"></a>							</div>						</td>'}if(u.hasOwnProperty("MEASURE_TEXT")&&u.MEASURE_TEXT.length>0){ac+='<td style="text-align: left">'+BX.util.htmlspecialchars(u.MEASURE_TEXT)+"</td>"}ac+="</tr>";ac+="</table>";ac+="</div>";ac+='<input type="hidden" id="QUANTITY_'+u.ID+'" name="QUANTITY_'+u.ID+'" value="'+u.QUANTITY+'" />';w.innerHTML=ac;if(c){updateQuantity("QUANTITY_INPUT_"+u.ID,u.ID,W,n)}break;case"PRICE":ab=b.insertCell(-1);a=(u.DISCOUNT_PRICE_PERCENT>0)?u.FULL_PRICE_FORMATED:"";ab.setAttribute("class","price");ab.innerHTML='<div class="current_price" id="current_price_'+u.ID+'">'+u.PRICE_FORMATED+'</div><div class="old_price" id="old_price_'+u.ID+'">'+a+"</div>";if(F&&u.NOTES.length>0){ab.innerHTML+='<div class="type_price">'+basketJSParams.SALE_TYPE+"</div>";ab.innerHTML+='<div class="type_price_value">'+u.NOTES+"</div>"}break;case"DISCOUNT":o=b.insertCell(-1);o.setAttribute("class","custom");o.innerHTML="<span>"+getColumnName(Q,E[ae])+":</span>";o.innerHTML+='<div id="discount_value_'+u.ID+'">'+u.DISCOUNT_PRICE_PERCENT_FORMATED+"</div>";break;case"WEIGHT":z=b.insertCell(-1);z.setAttribute("class","custom");z.innerHTML="<span>"+getColumnName(Q,E[ae])+":</span>";z.innerHTML+=u.WEIGHT_FORMATED;break;default:g=b.insertCell(-1);P="";g.setAttribute("class","custom");g.innerHTML="<span>"+getColumnName(Q,E[ae])+":</span>";if(E[ae]=="SUM"){P+='<div id="sum_'+u.ID+'">'}if(typeof(u[E[ae]])!="undefined"){P+=u[E[ae]]}if(E[ae]=="SUM"){P+="</div>"}g.innerHTML+=P;break}}if(Y||N){var ag=b.insertCell(-1);ag.setAttribute("class","control");if(Y){ag.innerHTML='<a href="'+basketJSParams.DELETE_URL.replace("#ID#",u.ID)+'">'+basketJSParams.SALE_DELETE+"</a><br />"}if(N){ag.innerHTML+='<a href="'+basketJSParams.DELAY_URL.replace("#ID#",u.ID)+'">'+basketJSParams.SALE_DELAY+"</a>"}}var r=b.insertCell(-1);r.setAttribute("class","margin")}}if(!!Q.BASKET_DATA){for(S in Q.BASKET_DATA.GRID.ROWS){if(Q.BASKET_DATA.GRID.ROWS.hasOwnProperty(S)){var O=Q.BASKET_DATA.GRID.ROWS[S];if(BX("discount_value_"+S)){BX("discount_value_"+S).innerHTML=O.DISCOUNT_PRICE_PERCENT_FORMATED}if(BX("current_price_"+S)){BX("current_price_"+S).innerHTML=O.PRICE_FORMATED}if(BX("old_price_"+S)){BX("old_price_"+S).innerHTML=(O.DISCOUNT_PRICE_PERCENT>0)?O.FULL_PRICE_FORMATED:""}if(BX("sum_"+S)){BX("sum_"+S).innerHTML=O.SUM}if(BX("QUANTITY_"+S)){BX("QUANTITY_INPUT_"+S).value=O.QUANTITY;BX("QUANTITY_INPUT_"+S).defaultValue=O.QUANTITY;BX("QUANTITY_"+S).value=O.QUANTITY}}}}if(!!Q.BASKET_DATA){couponListUpdate(Q.BASKET_DATA)}if(Q.hasOwnProperty("WARNING_MESSAGE")){var J="";for(ae=Q.WARNING_MESSAGE.length-1;ae>=0;ae--){J+=Q.WARNING_MESSAGE[ae]+"<br/>"}BX("warning_message").innerHTML=J}if(!!Q.BASKET_DATA){if(BX("allWeight_FORMATED")){BX("allWeight_FORMATED").innerHTML=Q.BASKET_DATA["allWeight_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allSum_wVAT_FORMATED")){BX("allSum_wVAT_FORMATED").innerHTML=Q.BASKET_DATA["allSum_wVAT_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allVATSum_FORMATED")){BX("allVATSum_FORMATED").innerHTML=Q.BASKET_DATA["allVATSum_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allSum_FORMATED")){BX("allSum_FORMATED").innerHTML=Q.BASKET_DATA["allSum_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("PRICE_WITHOUT_DISCOUNT")){var t=(Q.BASKET_DATA["PRICE_WITHOUT_DISCOUNT"]!=Q.BASKET_DATA["allSum_FORMATED"]);BX("PRICE_WITHOUT_DISCOUNT").innerHTML=t?Q.BASKET_DATA["PRICE_WITHOUT_DISCOUNT"].replace(/\s/g,"&nbsp;"):"";BX.style(BX("PRICE_WITHOUT_DISCOUNT").parentNode,"display",(t?"table-row":"none"))}BX.onCustomEvent("OnBasketChange")}}function couponCreate(a,b){var c="disabled";if(!BX.type.isElementNode(a)){return}if(b.JS_STATUS==="BAD"){c="bad"}else{if(b.JS_STATUS==="APPLYED"){c="good"}}a.appendChild(BX.create("div",{props:{className:"bx_ordercart_coupon"},children:[BX.create("input",{props:{className:c,type:"text",value:b.COUPON,name:"OLD_COUPON[]"},attrs:{disabled:true,readonly:true}}),BX.create("span",{props:{className:c},attrs:{"data-coupon":b.COUPON}}),BX.create("div",{props:{className:"bx_ordercart_coupon_notes"},html:b.JS_CHECK_CODE})]}))}function couponListUpdate(f){var c,a,b,k,h,e,d,g;if(!!f&&typeof f!=="object"){return}c=BX("coupons_block");if(!!c){if(!!f.COUPON_LIST&&BX.type.isArray(f.COUPON_LIST)){b=BX("coupon");if(!!b){b.value=""}k=BX.findChildren(c,{tagName:"input",property:{name:"OLD_COUPON[]"}},true);if(!!k){if(BX.type.isElementNode(k)){k=[k]}for(e=0;e<f.COUPON_LIST.length;e++){h=false;g=-1;for(d=0;d<k.length;d++){if(k[d].value===f.COUPON_LIST[e].COUPON){h=true;g=d;k[d].couponUpdate=true;break}}if(h){a="disabled";if(f.COUPON_LIST[e].JS_STATUS==="BAD"){a="bad"}else{if(f.COUPON_LIST[e].JS_STATUS==="APPLYED"){a="good"}}BX.adjust(k[g],{props:{className:a}});BX.adjust(k[g].nextSibling,{props:{className:a}});BX.adjust(k[g].nextSibling.nextSibling,{html:f.COUPON_LIST[e].JS_CHECK_CODE})}else{couponCreate(c,f.COUPON_LIST[e])}}for(d=0;d<k.length;d++){if(typeof(k[d].couponUpdate)==="undefined"||!k[d].couponUpdate){BX.remove(k[d].parentNode);k[d]=null}else{k[d].couponUpdate=null}}}else{for(e=0;e<f.COUPON_LIST.length;e++){couponCreate(c,f.COUPON_LIST[e])}}}}c=null}function skuPropClickHandler(){var g=this,j,k,h={},b={},e,a,f,c,d;if(!!g&&g.hasAttribute("data-value-id")){BX.showWait();j=g.getAttribute("data-element");k=g.getAttribute("data-property");e=BX("action_var").value;h[k]=BX.util.htmlspecialcharsback(g.getAttribute("data-value-id"));if(BX.hasClass(g,"bx_active")){BX.closeWait();return}a=BX.findChildren(BX(j),{tagName:"ul",className:"sku_prop_list"},true);if(!!a&&a.length>0){for(f=0;a.length>f;f++){if(a[f].id!=="prop_"+k+"_"+j){c=BX.findChildren(BX(a[f].id),{tagName:"li",className:"bx_active"},true);if(!!c&&c.length>0){for(d=0;c.length>d;d++){if(c[d].hasAttribute("data-value-id")){h[c[d].getAttribute("data-property")]=BX.util.htmlspecialcharsback(c[d].getAttribute("data-value-id"))}}}}}}b={basketItemId:j,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:h,action_var:e,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};b[e]="select_item";BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:b,dataType:"json",onsuccess:function(i){BX.closeWait();updateBasketTable(j,i)}})}}function getColumnName(a,b){if(BX("col_"+b)){return BX.util.trim(BX("col_"+b).innerHTML)}else{return""}}function leftScroll(e,d,c){c=parseInt(c,10);var b=BX("prop_"+e+"_"+d);if(b){var a=parseInt(b.style.marginLeft,10);if(a<=-20){b.style.marginLeft=a+20+"%"}}}function rightScroll(e,d,c){c=parseInt(c,10);var b=BX("prop_"+e+"_"+d);if(b){var a=parseInt(b.style.marginLeft,10);if(a>(5-c)*20){b.style.marginLeft=a-20+"%"}}}function checkOut(){if(!!BX("coupon")){BX("coupon").disabled=true}BX("basket_form").submit();return true}function updateBasket(){recalcBasketAjax({})}function enterCoupon(){var a=BX("coupon");if(!!a&&!!a.value){recalcBasketAjax({coupon:a.value})}}function showCouponBox(b){var a=BX("bx_ordercart_coupon_box");b.style.display="none";a.style.display="block"}function updateQuantity(m,e,k,d){var l=BX(m).defaultValue,c=parseFloat(BX(m).value)||0,i=false,b=((BX("auto_calculation")&&BX("auto_calculation").value=="Y")||!BX("auto_calculation"));if(k===0||k==1){i=true}else{var f=c*10000,g=k*10000,j=f%g,a=parseInt(c);if(j===0){i=true}}var h=false;if(parseInt(c)!=parseFloat(c)){h=true}c=(d===false&&h===false)?parseInt(c):parseFloat(c).toFixed(4);c=correctQuantity(c);if(i){BX(m).defaultValue=c;BX("QUANTITY_INPUT_"+e).value=c;BX("QUANTITY_"+e).value=c;if(b){basketPoolQuantity.changeQuantity(e)}}else{c=getCorrectRatioQuantity(c,k,d);c=correctQuantity(c);if(c!=l){BX("QUANTITY_INPUT_"+e).value=c;BX("QUANTITY_"+e).value=c;if(b){basketPoolQuantity.changeQuantity(e)}}else{BX(m).value=l}}}function setQuantity(b,e,a,f){var d=parseFloat(BX("QUANTITY_INPUT_"+b).value),c;c=(a=="up")?d+e:d-e;if(c<0){c=0}if(f){c=parseFloat(c).toFixed(4)}c=correctQuantity(c);if(e>0&&c<e){c=e}if(!f&&c!=c.toFixed(4)){c=parseFloat(c).toFixed(4)}c=getCorrectRatioQuantity(c,e,f);c=correctQuantity(c);BX("QUANTITY_INPUT_"+b).value=c;BX("QUANTITY_INPUT_"+b).defaultValue=c;updateQuantity("QUANTITY_INPUT_"+b,b,e,f)}function getCorrectRatioQuantity(d,h,a){var b=d*10000,c=h*10000,g=(d/h-((d/h).toFixed(0))).toFixed(6),j=d,e=false,f;h=parseFloat(h);if(g==0){return j}if(h!==0&&h!=1){for(f=h,max=parseFloat(d)+parseFloat(h);f<=max;f=parseFloat(parseFloat(f)+parseFloat(h)).toFixed(4)){j=f}}else{if(h===1){j=d|0}}if(parseInt(j,10)!=parseFloat(j)){e=true}j=(a===false&&e===false)?parseInt(j,10):parseFloat(j).toFixed(4);j=correctQuantity(j);return j}function correctQuantity(a){return parseFloat((a*1).toString())}function recalcBasketAjax(g){if(basketPoolQuantity.isProcessing()){return false}BX.showWait();var e={},d=BX("action_var").value,b=BX("basket_items"),f=BX("delayed_items"),a,c;a={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:e,action_var:d,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};a[d]="recalculate";if(!!g&&typeof g==="object"){for(c in g){if(g.hasOwnProperty(c)){a[c]=g[c]}}}if(!!b&&b.rows.length>0){for(c=1;b.rows.length>c;c++){a["QUANTITY_"+b.rows[c].id]=BX("QUANTITY_"+b.rows[c].id).value}}if(!!f&&f.rows.length>0){for(c=1;f.rows.length>c;c++){a["DELAY_"+f.rows[c].id]="Y"}}basketPoolQuantity.setProcessing(true);basketPoolQuantity.clearPool();BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:a,dataType:"json",onsuccess:function(h){BX.closeWait();basketPoolQuantity.setProcessing(false);if(g.coupon){if(!!h&&!!h.BASKET_DATA&&!!h.BASKET_DATA.NEED_TO_RELOAD_FOR_GETTING_GIFTS){BX.reload()}}if(basketPoolQuantity.isPoolEmpty()){updateBasketTable(null,h);basketPoolQuantity.updateQuantity()}else{basketPoolQuantity.enableTimer(true)}}})}function showBasketItemsList(a){BX.removeClass(BX("basket_toolbar_button"),"current");BX.removeClass(BX("basket_toolbar_button_delayed"),"current");BX.removeClass(BX("basket_toolbar_button_subscribed"),"current");BX.removeClass(BX("basket_toolbar_button_not_available"),"current");BX("normal_count").style.display="inline-block";BX("delay_count").style.display="inline-block";BX("subscribe_count").style.display="inline-block";BX("not_available_count").style.display="inline-block";if(a==2){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="block";BX.addClass(BX("basket_toolbar_button_delayed"),"current")}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}else{if(a==3){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="block";BX.addClass(BX("basket_toolbar_button_subscribed"),"current")}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}else{if(a==4){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="block";BX.addClass(BX("basket_toolbar_button_not_available"),"current")}}else{if(BX("basket_items_list")){BX("basket_items_list").style.display="block";BX.addClass(BX("basket_toolbar_button"),"current")}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}}}}function deleteCoupon(){var b=this,a;if(!!b&&b.hasAttribute("data-coupon")){a=b.getAttribute("data-coupon");if(!!a&&a.length>0){recalcBasketAjax({delete_coupon:a})}}}function deleteProductRow(c){var b=BX.findParent(c,{tagName:"TR"}),a,d;if(b){a=BX("QUANTITY_"+b.id);if(a){d=getCurrentItemAnalyticsInfo(b,a.value)}}setAnalyticsDataLayer([],[d]);document.location.href=c.href;return false}function checkAnalytics(d,b){if(!d||!b||BX.util.array_values(d).length===0){return}var h,g,f={},a=[],e=[],c;if(!!b&&b.rows.length){for(c=1;b.rows.length>c;c++){h=b.rows[c].id;g=BX("QUANTITY_"+h).value-d[h];if(g!=0){f=getCurrentItemAnalyticsInfo(b.rows[c],g);if(g>0){a.push(f)}else{e.push(f)}}}}if(a.length||e.length){setAnalyticsDataLayer(a,e)}}function getCurrentItemAnalyticsInfo(f,e){if(!f){return}var c,b,a=[];var d={name:f.getAttribute("data-item-name")||"",id:f.id,price:f.getAttribute("data-item-price")||0,brand:(f.getAttribute("data-item-brand")||"").split(",  ").join("/"),variant:"",quantity:Math.abs(e)};c=f.querySelectorAll(".bx_active[data-sku-name]");for(b=0;b<c.length;b++){a.push(c[b].getAttribute("data-sku-name"))}d.variant=a.join("/");return d}function setAnalyticsDataLayer(a,b){window[basketJSParams.DATA_LAYER_NAME]=window[basketJSParams.DATA_LAYER_NAME]||[];if(a&&a.length){window[basketJSParams.DATA_LAYER_NAME].push({event:"addToCart",ecommerce:{currencyCode:getCurrencyCode(),add:{products:a}}})}if(b&&b.length){window[basketJSParams.DATA_LAYER_NAME].push({event:"removeFromCart",ecommerce:{currencyCode:getCurrencyCode(),remove:{products:b}}})}}function getCurrencyCode(){var b=BX("basket_items"),c,a="";if(b){c=b.querySelector("[data-item-currency");c&&(a=c.getAttribute("data-item-currency"))}return a}BX.ready(function(){basketPoolQuantity=new BasketPoolQuantity();var b=BX("coupons_block"),c=BX("basket_items");if(BX.type.isElementNode(b)){BX.bindDelegate(b,"click",{attribute:"data-coupon"},deleteCoupon)}if(BX.type.isElementNode(c)){BX.bindDelegate(c,"click",{tagName:"li",attr:{"data-sku-selector":"Y"}},skuPropClickHandler)}if(BX.type.isNotEmptyString(basketJSParams.EVENT_ONCHANGE_ON_START)&&basketJSParams.EVENT_ONCHANGE_ON_START=="Y"){BX.onCustomEvent("OnBasketChange")}var a=BX("content-page");a.classList.add("content-page-basket")});